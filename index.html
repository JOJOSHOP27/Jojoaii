<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOELL AI · pro assistant</title>
    <style>
        /* === MODERN & LENGKAP === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #f0f5fa 0%, #e2eaf2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .joell-container {
            max-width: 1200px;
            width: 100%;
            height: 90vh;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 48px;
            box-shadow: 0 30px 70px -20px rgba(0, 20, 40, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.7) inset;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* header premium */
        .header-premium {
            padding: 1.5rem 2.2rem;
            background: rgba(255,255,255,0.4);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar-glow {
            width: 58px;
            height: 58px;
            background: linear-gradient(135deg, #0e1c36, #1c2e4a);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 2rem;
            box-shadow: 0 15px 25px -8px #0e1c36, 0 0 0 2px rgba(255,255,255,0.5);
        }

        .title-section {
            flex: 1;
        }

        .title-section h1 {
            font-size: 2rem;
            font-weight: 650;
            background: linear-gradient(145deg, #0e1c36, #1f3a5f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }

        .title-section .sub {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 4px;
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #e6f0f9;
            padding: 0.3rem 1rem;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #0f2a44;
        }

        .dot-live {
            width: 10px;
            height: 10px;
            background: #16a34a;
            border-radius: 50%;
            box-shadow: 0 0 0 2px white;
        }

        .model-tag {
            background: #ffffffc0;
            backdrop-filter: blur(4px);
            padding: 0.3rem 1rem;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #172554;
            border: 1px solid white;
        }

        /* main chat */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 2.2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background: rgba(240, 248, 255, 0.2);
        }

        /* message styling */
        .msg {
            display: flex;
            max-width: 80%;
            animation: appear 0.3s cubic-bezier(0.2, 0.9, 0.3, 1);
        }

        .msg.user {
            align-self: flex-end;
        }

        .msg.bot {
            align-self: flex-start;
        }

        .msg.bubble {
            padding: 1rem 1.6rem;
            border-radius: 32px;
            font-size: 1rem;
            line-height: 1.5;
            word-break: break-word;
            box-shadow: 0 6px 16px rgba(0,0,0,0.03);
        }

        .user .bubble {
            background: #0f172a;
            color: white;
            border-bottom-right-radius: 10px;
            box-shadow: 0 12px 22px -12px #0f172a;
        }

        .bot .bubble {
            background: rgba(255, 255, 255, 0.9);
            color: #1f2a44;
            border-bottom-left-radius: 10px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.8);
        }

        /* loading indicator */
        .msg.bot.loading .bubble {
            background: #ffffffec;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 2rem;
        }

        .typing-dots {
            display: flex;
            gap: 6px;
        }
        .typing-dots span {
            width: 10px;
            height: 10px;
            background: #1f3a5f;
            border-radius: 50%;
            animation: wave 1.4s infinite;
        }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes wave {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        /* error */
        .msg.bot.error .bubble {
            background: #fff3f0;
            color: #bc1c1c;
            border-left: 6px solid #e04f4f;
        }

        /* input area mewah */
        .input-premium {
            padding: 1.8rem 2.2rem;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255,255,255,0.9);
        }

        .input-group {
            display: flex;
            gap: 16px;
            background: white;
            border-radius: 60px;
            padding: 0.2rem 0.2rem 0.2rem 1.8rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.02);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .input-group input {
            flex: 1;
            padding: 1.1rem 0.2rem;
            border: none;
            background: transparent;
            font-size: 1.05rem;
            outline: none;
        }

        .input-group input:disabled {
            background: #f4f8fd;
            color: #7e8b9e;
        }

        .send-action {
            background: #0f172a;
            border: none;
            width: 58px;
            height: 58px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 12px 18px -8px #0f172a;
        }

        .send-action:hover:not(:disabled) {
            background: #1d334f;
            transform: scale(1.03);
        }

        .send-action:disabled {
            background: #b7c9dd;
            box-shadow: none;
            cursor: not-allowed;
        }

        .send-action svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        @keyframes appear {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* scrollbar cantik */
        .chat-area::-webkit-scrollbar {
            width: 6px;
        }
        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }
        .chat-area::-webkit-scrollbar-thumb {
            background: #a3b8d0;
            border-radius: 20px;
        }

        @media (max-width: 600px) {
            .joell-container { height: 95vh; border-radius: 28px; }
            .header-premium { padding: 1rem 1.5rem; }
            .avatar-glow { width: 46px; height: 46px; font-size: 1.6rem; }
            .title-section h1 { font-size: 1.6rem; }
            .chat-area { padding: 1.5rem; }
            .msg { max-width: 90%; }
            .input-premium { padding: 1.2rem 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="joell-container">
        <!-- HEADER MEWAH -->
        <div class="header-premium">
            <div class="avatar-glow">J</div>
            <div class="title-section">
                <h1>JOELL AI</h1>
                <div class="sub">
                    <span class="live-badge"><span class="dot-live"></span> live · siap membantu</span>
                    <span class="model-tag">Gemini 1.5 Pro</span>
                </div>
            </div>
        </div>

        <!-- AREA PESAN -->
        <div class="chat-area" id="chatMessages"></div>

        <!-- INPUT AREA -->
        <div class="input-premium">
            <div class="input-group">
                <input type="text" id="userInput" placeholder="Tanyakan apa saja ..." autofocus>
                <button class="send-action" id="sendButton">
                    <svg viewBox="0 0 24 24">
                        <path d="M2 21L22 12L2 3V10L16 12L2 14V21Z" />
                    </svg>
                </button>
            </div>
            <p style="font-size:0.7rem; margin-top:8px; color:#3b4e66; opacity:0.7; text-align:center;">⚡ model pro · konteks penuh · jawaban detail</p>
        </div>
    </div>

    <script>
        (function() {
            // ===== KONFIGURASI =====
            const API_KEY = 'AIzaSyBrYui8RFhNPYOZzRAH46cWQLMYNIdSQbI';   // API key baru
            // Ganti model di sini: 'gemini-1.5-pro' (lebih lengkap) atau 'gemini-1.5-flash' (lebih cepat)
            const MODEL = 'gemini-1.5-pro';        // Menggunakan model pro untuk kelengkapan
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;

            // ===== DOM ELEMENTS =====
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');

            // ===== STATE =====
            let conversationHistory = [];       // menyimpan { role, text }
            let loadingEl = null;                // elemen loading
            let isProcessing = false;

            // ===== UTILITIES =====
            function scrollToBottom() {
                chatMessages.scrollTo({
                    top: chatMessages.scrollHeight,
                    behavior: 'smooth'
                });
            }

            // tambah pesan ke chat
            function appendMessage(role, text, saveToHistory = false, isError = false) {
                const msgDiv = document.createElement('div');
                msgDiv.classList.add('msg', role);
                if (isError) msgDiv.classList.add('error');

                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                bubble.textContent = text;
                msgDiv.appendChild(bubble);
                chatMessages.appendChild(msgDiv);

                if (saveToHistory) {
                    conversationHistory.push({ role: role, text: text });
                }

                scrollToBottom();
                return msgDiv;
            }

            // tampilkan indikator mengetik (bot)
            function showTypingIndicator() {
                if (loadingEl) return; // sudah ada
                const loader = document.createElement('div');
                loader.classList.add('msg', 'bot', 'loading');
                loader.innerHTML = `
                    <div class="bubble">
                        <span>JOELL AI sedang menulis</span>
                        <div class="typing-dots">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(loader);
                loadingEl = loader;
                scrollToBottom();
            }

            function removeTypingIndicator() {
                if (loadingEl && loadingEl.parentNode) {
                    loadingEl.remove();
                    loadingEl = null;
                }
            }

            function setBusyState(busy) {
                isProcessing = busy;
                userInput.disabled = busy;
                sendButton.disabled = busy;
            }

            // ===== PANGGIL API GEMINI =====
            async function callGemini(contents) {
                const requestBody = {
                    contents: contents,
                    generationConfig: {
                        temperature: 0.85,          // sedikit kreatif
                        maxOutputTokens: 2048,      // respons lebih panjang untuk pro
                        topP: 0.95,
                        topK: 40
                    },
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                    ]
                };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        let errorDetail = `HTTP ${response.status}`;
                        try {
                            const errJson = await response.json();
                            errorDetail = errJson.error?.message || JSON.stringify(errJson);
                        } catch (e) {}
                        throw new Error(`Gagal: ${errorDetail}`);
                    }

                    const data = await response.json();
                    const candidate = data.candidates?.[0];
                    if (!candidate) throw new Error('Tidak ada kandidat respons.');

                    // Cek jika dihentikan karena safety
                    if (candidate.finishReason && candidate.finishReason !== 'STOP') {
                        console.warn('Finish reason:', candidate.finishReason);
                        if (candidate.finishReason === 'SAFETY') {
                            throw new Error('Respons diblokir sistem keamanan. Coba tanyakan dengan kata lain.');
                        } else {
                            throw new Error(`Respons terhenti (${candidate.finishReason})`);
                        }
                    }

                    const textPart = candidate.content?.parts?.[0]?.text;
                    if (!textPart) throw new Error('Respons kosong.');
                    return textPart;
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            }

            // ===== KIRIM PESAN =====
            async function sendUserMessage() {
                const userMessage = userInput.value.trim();
                if (userMessage === '' || isProcessing) return;

                // clear input
                userInput.value = '';
                setBusyState(true);

                // tampilkan pesan user & simpan history
                appendMessage('user', userMessage, true);

                // tampilkan loading
                showTypingIndicator();

                // siapkan content dari history (role user dan model)
                const contentsForAPI = conversationHistory.map(entry => ({
                    role: entry.role,
                    parts: [{ text: entry.text }]
                }));

                try {
                    // panggil API dengan model pro
                    const reply = await callGemini(contentsForAPI);

                    // hapus loading
                    removeTypingIndicator();

                    // tampilkan respons bot dan simpan ke history
                    appendMessage('bot', reply, true);
                } catch (error) {
                    removeTypingIndicator();
                    // tampilkan error sebagai bot tanpa menyimpan ke history
                    appendMessage('bot', `⚠️ ${error.message}`, false, true);
                } finally {
                    setBusyState(false);
                    userInput.focus();
                }
            }

            // ===== INIT =====
            function initChat() {
                // Pesan sambutan dari JOELL AI
                const welcomeMsg = 'Halo! Saya **JOELL AI** dengan model **Gemini 1.5 Pro**. Saya siap membantu Anda dengan pertanyaan apa pun secara detail dan akurat. Ada yang bisa saya jelaskan?';
                // Untuk menghindari markdown, kita tampilkan plain dulu
                appendMessage('bot', 'Halo! Saya JOELL AI dengan model Gemini 1.5 Pro. Saya siap membantu Anda dengan pertanyaan apa pun secara detail dan akurat. Ada yang bisa saya jelaskan?', true);
            }

            // event listeners
            sendButton.addEventListener('click', sendUserMessage);
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendUserMessage();
                }
            });

            initChat();

            // OPSIONAL: jika model pro tidak tersedia (misal region), kita bisa kasih saran fallback di console
            // Tapi tidak perlu ditampilkan ke user, karena error akan muncul di chat.
        })();
    </script>
</body>
</html>